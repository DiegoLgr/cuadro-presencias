<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <script src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <!-- script de la aplicacion -->
    <script src="tabla.js" charset="utf-8"></script>
    <script src="controlador.js" charset="utf-8"></script>
    <!-- estilos de la aplicacion   -->
    <link rel="stylesheet" href="tabla.css">
    <title>Tabla</title>
  </head>
  <body>
    <table id="tabla"></table>
    <button id="anadirTrabajador">AÃ±adir Trabajador</button>
    <script type="text/javascript">
      let controlador = new ControladorCuadro()
      controlador.CargarDatosYPintar()
      botonAnadirTrabajador = document.getElementById('anadirTrabajador')
      botonAnadirTrabajador.addEventListener('click', (e)=>controlador.mostrarFormAnadirTrabajadores())
    </script>
  <button id="mostrar-trabajadores">Trabajadores</button>
  <script type="text/javascript">
  botonMostrarTrabajadores = document.getElementById('mostrar-trabajadores')
  botonMostrarTrabajadores.addEventListener('click', (e)=>{
    let lista = document.createElement('ul')
    document.getElementsByTagName('body')[0].appendChild(lista)
    let request = new XMLHttpRequest()
    let resultado = new Promise((resolve,reject)=>{
      request.onreadystatechange = function (){
        if (request.readyState == 4)
          if (request.status == 200){
            let response = JSON.parse(request.response)
            response.forEach((trabajador)=>{
              let trab = document.createElement('li')
              trab.innerHTML = trabajador.nombre
              lista.appendChild(trab)
            })
            resolve()
          }
          else reject("No se han conseguido los trabajadores.")
      }
    })
    request.open('GET', 'http://localhost:8000/trabajadores/',true)
    request.send(null)
    console.log(resultado)
  })

  </script>
  </body>
</html>
